// Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
// SPDX-License-Identifier: Apache-2.0

apply plugin: 'org.jetbrains.intellij'
apply plugin: 'jacoco'

dependencies {
    compile project(":")
    compile project(path: ":core", configuration: 'testArtifacts')
}

intellij {
    version ideVersion("IC")
    updateSinceUntilBuild false
    downloadSources false
    instrumentCode false
    plugins = idePlugins("IC") + ['com.intellij.testGuiFramework:193.SNAPSHOT.1@nightly', project(":")]
}

jacoco.applyTo(runIde)
runIde {
    systemProperties System.properties.findAll {(it.key as String).startsWith("idea") || (it.key as String).startsWith("jb")}
    /* Need to split the space-delimited value in the exec.args */
    args System.getProperty("exec.args", "").split(",")
    jacoco {
        includeNoLocationClasses = true
        includes = ["software.aws.toolkits.*"]
    }
}

// don't run gui tests as part of check
test.enabled = false

task guiTest(type: Test) {
    workingDir = project.rootDir
    systemProperty("idea.gui.tests.gradle.runner", true)
    include '**/*TestSuite*'
}

jar {
    from(sourceSets.test.output)
}
